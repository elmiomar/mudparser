# RFC 9761 Compliance

MudParser provides support for RFC 9761 - Manufacturer Usage Description (MUD) for TLS and DTLS Profiles for IoT Devices.

## Overview

RFC 9761 extends MUD to allow manufacturers to specify the TLS/DTLS behavior expected from their devices. This enables network security services to detect unexpected TLS usage that might indicate compromise.

## Supported Features

### TLS Client Profile

| Field | Status | Description |
|-------|--------|-------------|
| `tls-versions` | ✅ Supported | Allowed TLS/DTLS versions |
| `cipher-suites` | ✅ Supported | Allowed cipher suites |
| `spki-pins` | ✅ Supported | Certificate pinning hashes |
| `client-authentication` | ✅ Supported | Client auth behavior |
| `alpn-protocols` | ✅ Supported | ALPN protocols |
| `sni-required` | ✅ Supported | SNI extension requirement |

### TLS Server Profile

| Field | Status | Description |
|-------|--------|-------------|
| `tls-versions` | ✅ Supported | Allowed TLS/DTLS versions |
| `cipher-suites` | ✅ Supported | Allowed cipher suites |
| `client-authentication` | ✅ Supported | Client auth requirements |
| `alpn-protocols` | ✅ Supported | ALPN protocols |

### TLS Versions

| Version | Status |
|---------|--------|
| TLS 1.0 | ✅ Supported (marked deprecated) |
| TLS 1.1 | ✅ Supported (marked deprecated) |
| TLS 1.2 | ✅ Supported |
| TLS 1.3 | ✅ Supported |
| DTLS 1.0 | ✅ Supported (marked deprecated) |
| DTLS 1.2 | ✅ Supported |
| DTLS 1.3 | ✅ Supported |

### Client Authentication

| Value | Description |
|-------|-------------|
| `none` | No client authentication |
| `optional` | Client auth optional |
| `required` | Client auth required |

## Usage

### Parsing TLS Profiles

```python
from mudparser.models.tls import TLSProfile, TLSVersion

# Create from JSON data
tls_data = {
    "client-profile": {
        "tls-versions": ["tls-1.2", "tls-1.3"],
        "cipher-suites": [
            "TLS_AES_128_GCM_SHA256",
            "TLS_AES_256_GCM_SHA384"
        ],
        "sni-required": True
    }
}

profile = TLSProfile.from_json(tls_data)

# Check versions
print(f"Min TLS version: {profile.client_profile.get_min_version()}")
print(f"Allows deprecated: {profile.client_profile.allows_deprecated_versions()}")
```

### Security Analysis

```python
# Check for security concerns
concerns = profile.has_security_concerns()

for concern in concerns:
    print(f"Warning: {concern}")
```

Example output:
```
Warning: Deprecated TLS versions allowed: tls-1.0, tls-1.1
Warning: No certificate pinning configured
```

### Accessing TLS Data

```python
# Get all versions
all_versions = profile.get_all_tls_versions()

# Get all cipher suites
all_suites = profile.get_all_cipher_suites()

# Check suite security
for suite in all_suites:
    if not suite.is_secure():
        print(f"Insecure suite: {suite.name}")
```

## Data Models

### TLSProfile

The main container for TLS configuration:

```python
from mudparser.models.tls import TLSProfile

profile = TLSProfile(
    client_profile=TLSClientProfile(...),
    server_profile=TLSServerProfile(...),
    description="Device TLS configuration"
)
```

### TLSVersion

Enumeration of TLS/DTLS versions:

```python
from mudparser.models.tls import TLSVersion

version = TLSVersion.TLS_1_3
print(version.is_dtls)       # False
print(version.is_deprecated) # False
```

### CipherSuite

Cipher suite specification:

```python
from mudparser.models.tls import CipherSuite

suite = CipherSuite(
    name="TLS_AES_128_GCM_SHA256",
    value=0x1301
)
print(suite.is_secure())  # True
```

### SPKIHash

Certificate pinning hash:

```python
from mudparser.models.tls import SPKIHash

pin = SPKIHash(
    algorithm="sha256",
    value="base64_encoded_hash"
)
print(str(pin))  # sha256/base64_encoded_hash
```

## Security Recommendations

1. **Use TLS 1.2+** - Avoid deprecated versions (TLS 1.0, 1.1)
2. **Use strong ciphers** - Avoid NULL, EXPORT, DES, RC4, MD5
3. **Enable SNI** - Required for proper certificate validation
4. **Use certificate pinning** - Helps prevent MITM attacks
5. **Require mutual auth** - For high-security devices

## Integration with MUD Profiles

TLS profiles can be integrated with MUD profiles to provide complete device behavior specification:

```json
{
  "ietf-mud:mud": {
    "mud-version": 1,
    ...
  },
  "ietf-access-control-list:access-lists": {
    ...
  },
  "ietf-mud-tls:mud-tls": {
    "client-profile": {
      "tls-versions": ["tls-1.2", "tls-1.3"]
    }
  }
}
```

## References

- [RFC 9761 - MUD (D)TLS Profiles for IoT Devices](https://datatracker.ietf.org/doc/rfc9761/)
- [RFC 8446 - TLS 1.3](https://datatracker.ietf.org/doc/rfc8446/)
